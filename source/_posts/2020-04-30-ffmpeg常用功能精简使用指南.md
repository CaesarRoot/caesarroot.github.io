---
title: ffmpeg常用功能精简使用指南
date: 2020-04-30 10:16:16
categories: [linux]
tags:
cover_img: https://s1.ax1x.com/2020/08/25/dc2LpF.jpg
feature_img: https://s1.ax1x.com/2020/08/25/dc2LpF.jpg
description:
keywords:
---

ffmpeg命令是一个强大的流媒体处理命令。下面是几个常用的可以使用ffmpeg来解决的问题场景：

1. 压缩文件大小
2. 剪辑视频长度
3. 下载网页视频



## 安装

直接看官网就行

https://www.ffmpeg.org/download.html

macos下可以用brew安装

```shell
brew install ffmpeg
```



## 压缩文件大小

ffmpeg本身支持多种压缩方法，包括码率和其他的格式等。这些命令一般比较复杂，其实有一个特别简单的方法：

```shell
ffmpeg -i input.mp4 output.mp4
```

默认的ffmpeg命令就已经优化了视频的压缩算法，因此直接导入导出就可以明显缩减视频大小



## 剪辑视频长度

有时候只想简单的截取视频的某一部分，这时可能手边没有视频剪辑软件，或者是视频剪辑软件太重，对于这个轻量级的任务ffmpeg有更好的解法：

```shell
ffmpeg -ss 00:01:00 -i input.mp4 -t 00:01:00 -c copy output.mp4
```

上面这个命令将input.mp4视频中1分钟-2分钟的部分剪辑出来，存放在output.mp4中

`-ss`意思是一个偏移量，即从1分钟的地方开始

`-i`意思是输入文件

`-t`是要剪辑的视频长度，上面命令为一分钟

`-c`表示不重新编码。这个参数应该是为了加速处理过程，应该不是特别重要



## 下载网页视频

在这个需求上ffmpeg真的是神器。

现在网页播放的视频，基本没有网站会把完整的mp4的url放在response中，基本都会采用另外一些格式，例如m3u8格式，这种格式会有一个index文件，标识了视频的元信息，后续的视频通过分片的方式，每个分片都是一个小的ts文件，这些文件组合起来就是一个完整的视频。如果手动下载所有的ts再组合就太麻烦了，这里用ffmpeg就会变得非常简单。

我们随便打开一个视频：http://www.dytt.com/vod-play-id-94467-src-1-num-7.html

打开控制台，看network，搜索m3u8

<img src="https://s1.ax1x.com/2020/04/30/JbEDEQ.png" alt="JbEDEQ.png" border="0" />

点开看请求头

<img src="https://s1.ax1x.com/2020/04/30/JbEfDU.png" alt="JbEfDU.png" border="0" />

复制到命令行，如下

```shell
ffmpeg -i https://us8.wl-cdn.com/hls/20200403/090990addb56baa30668886c0095679b/index.m3u8 output.mp4
```

就会开始自动下载了

<img src="https://s1.ax1x.com/2020/04/30/JbEzUH.png" alt="JbEzUH.png" border="0" />

整个过程就是下载ts文件，然后拼起来

<img src="https://s1.ax1x.com/2020/04/30/JbeggI.png" alt="JbeggI.png" border="0" />



## 在线播放视屏

利用ffplay可以直接在线播放，而不用等到视屏下载完毕，支持多种格式，例如m3u8格式只要输入如下命令：

```shell
ffplay -i https://youku.com-iqiyi.net/20180128/IVmdoB2k/index.m3u8
```

会弹出一个窗口直接播放，且支持快进、暂停等