---
title: 最长有效括号
date: 2019-10-06 22:08:22
categories: [算法]
tags: [刷题, 动态规划, 栈]
cover_img:
feature_img:
description:
keywords:
---

# 题目

给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。

示例 1:

输入: "(()"
输出: 2
解释: 最长有效括号子串为 "()"
示例 2:

输入: ")()())"
输出: 4
解释: 最长有效括号子串为 "()()"

来源：力扣（LeetCode）
链接：https://leetcode-cn.com/problems/longest-valid-parentheses



# 思路

最开始想到用栈模拟。

题解里面用的是动态规划感觉还是比较容易些。



# 题解

作者：LeetCode
链接：https://leetcode-cn.com/problems/longest-valid-parentheses/solution/zui-chang-you-xiao-gua-hao-by-leetcode/
来源：力扣（LeetCode）



定义一个dp数组。第i个位置为以i结尾的最长括号的长度。

那么可以得到递推关系：

![image](https://s2.ax1x.com/2019/10/12/uXqRC8.png)

```java
public class Solution {
    public int longestValidParentheses(String s) {
        int maxans = 0;
        int dp[] = new int[s.length()];
        for (int i = 1; i < s.length(); i++) {
            if (s.charAt(i) == ')') {
                if (s.charAt(i - 1) == '(') {
                    dp[i] = (i >= 2 ? dp[i - 2] : 0) + 2;
                } else if (i - dp[i - 1] > 0 && s.charAt(i - dp[i - 1] - 1) == '(') {
                    dp[i] = dp[i - 1] + ((i - dp[i - 1]) >= 2 ? dp[i - dp[i - 1] - 2] : 0) + 2;
                }
                maxans = Math.max(maxans, dp[i]);
            }
        }
        return maxans;
    }
}
```



用栈模拟

注意一下整个栈清空时候能正确计算。即()()可以算出4。

这样就要保留一下前一个位置的信息，且用下标直接减，不要用pop出来的数字+1。

![image](https://s2.ax1x.com/2019/10/12/uXL8xg.png)

```java
public class Solution {
    public int longestValidParentheses(String s) {
        int maxans = 0;
        Stack<Integer> stack = new Stack<>();
        stack.push(-1);
        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') {
                stack.push(i);
            } else {
                stack.pop();  // 直接舍弃
                if (stack.empty()) {
                    stack.push(i);  // 处理的就是)()()这种情况
                } else {  // 计算舍弃之后的前一位到目前的距离
                    maxans = Math.max(maxans, i - stack.peek());
                }
            }
        }
        return maxans;
    }
}

```

